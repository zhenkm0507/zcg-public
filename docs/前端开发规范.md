---
description: 
globs: frontend/**
alwaysApply: false
---
# 前端开发规范

## 1. 核心技术栈
- **框架**: React 18 + Next.js 14
- **语言**: TypeScript 5
- **UI库**: Ant Design 5
- **样式**: CSS Modules
- **HTTP客户端**: Axios

## 2. 目录结构规范
frontend/
├── src/
│   ├── app/                  # Next.js 13+ App Router 页面目录
│   │   └── [page]/          # 每个页面目录
│   │       ├── page.tsx     # 页面组件
│   │       └── page.module.css # 页面样式
│   ├── components/          # 可复用组件
│   │   ├── Layout/         # 布局组件
│   │   ├── Breadcrumb/     # 面包屑组件
│   │   ├── TablePagination/# 分页组件
│   │   ├── WordFilter/     # 单词过滤组件
│   │   ├── AnswerRecordPopover/ # 答题记录弹窗
│   │   ├── StudyHeader/    # 学习页面头部
│   │   └── WordBankSelector/# 词库选择器
│   ├── services/           # API 服务层
│   │   ├── index.ts        # 服务统一导出
│   ├── types/              # TypeScript 类型定义
│   │   ├── index.ts        # 类型统一导出
│   ├── utils/              # 工具函数
│   └── config/             # 配置文件

## 3. 页面开发规范
- **重要规定**: 所有页面都不应该在页面组件中使用Layout组件
- **原因说明**: 
  - 根目录Layout (`/app/layout.tsx`) 已经全局包裹所有页面，包含菜单导航
  - 子目录Layout (如 `/app/study/layout.tsx`) 只是样式包装，不包含菜单导航
  - 页面中使用Layout会导致嵌套，出现重复菜单导航
- **Layout使用规则**:
  - 根目录页面（如：`/`、`/settings`、`/login`）不要使用Layout组件
  - 子目录页面（如：`/study/*`、`/word/*`）不要使用Layout组件
  - 所有页面都会被根目录Layout自动包裹
- 页面结构必须遵循以下顺序：
  1. 页面主体内容（直接返回，不要包裹Layout组件）

## 3.1 /study 及子目录页面结构统一规范

- /study 及其子目录下所有页面，内容区域必须直接放在 .container 容器内，且背景色为 #fff，不允许多余的卡片（.card）包裹。
- 页面结构统一如下：
  ```tsx
  // 正确示例
  return (
    <div className={styles.container}>
      <Breadcrumb />
      {/* 其他筛选、Tabs等 */}
      <div className={styles.tableWrapper}>
        <Table ... />
      </div>
    </div>
  );
  ```
- 禁止在页面中使用 Card 组件或自定义 .card 样式包裹主内容区域。
- .container 必须设置 `background: #fff; padding: 24px; min-height: 100vh;`，与单词列表页保持一致。
- 如需表格与筛选区域间距，统一使用 `.tableWrapper { margin-top: 24px; }`。

## 4. 组件使用规范
- **场景化组件**: 根据具体业务场景使用以下组件：
  - `TablePagination`: 列表页面必须使用的分页组件
  - `WordFilter`: 单词过滤组件，用于单词列表页面的筛选功能
  - `AnswerRecordPopover`: 答题记录弹窗组件，用于展示用户的答题历史
  - `StudyHeader`: 学习页面头部组件，用于展示学习进度和统计信息
  - `WordBankSelector`: 词库选择器组件，用于切换词库

- **组件使用场景**:
  | 组件名称 | 使用场景 | 说明 |
  |---|---|---|
  | Breadcrumb | 二级菜单页面 | 页面导航路径 |
  | TablePagination | 列表页面 | 分页功能 |
  | WordFilter | 单词列表页面 | 单词筛选功能 |
  | AnswerRecordPopover | 单词详情页面 | 展示答题历史 |
  | StudyHeader | 学习页面 | 展示学习进度 |
  | WordBankSelector | 需要切换词库的页面 | 词库切换功能 |

- **组件开发规范**:
  - 所有组件必须放在 `components` 目录下
  - 组件目录使用 PascalCase 命名
  - 组件必须包含以下文件：
    - `index.tsx`: 组件主文件
    - `index.module.css`: 组件样式文件
    - `types.ts`: 组件类型定义（可选）
  - 组件必须导出类型定义
  - 组件必须添加必要的注释说明

### 4.1 面包屑组件使用规范
- **使用场景**:
  - 一级菜单页面不使用面包屑（如：难词列表、学习记录、系统设置）
  - 二级菜单页面必须使用面包屑（如：单词列表、特殊形式）
- **实现方式**:
  - 使用全局统一的 `Breadcrumb` 组件
  - 面包屑配置统一在 `components/Breadcrumb/index.tsx` 中维护
  - 根据路由自动生成面包屑导航
- **配置说明**:
  - 在 `menuItems` 中配置菜单结构
  - 使用 `hasRoute` 属性标记是否有实际路由
  - 使用 `children` 属性配置子菜单

## 5. API调用规范
- **强制规定**: 所有API调用必须通过 `utils/request.ts` 封装的实例进行
- API服务必须在 `services/` 目录下按功能模块进行组织
- 新增API服务必须在 `services/index.ts` 中统一导出
- 所有API响应必须遵循统一格式，使用/types/commom.ts中的type

### 5.1 API响应数据处理
- **强制规定**: 所有API响应数据必须从 `response.data.data` 中获取
- API响应数据结构：
  ```typescript
  {
    data: {
      data: T,  // 实际业务数据
      code: number,  // 业务状态码
      message: string  // 业务消息
    }
  }
  ```
- 错误处理：
  - 网络错误由拦截器统一处理
  - HTTP状态错误(401/404/500等)由拦截器统一处理
  - 业务逻辑错误(code !== 0)由拦截器统一处理
  - 特定业务错误可在API调用的 `catch` 块中处理

## 6. 类型定义规范
- 所有API请求和响应必须定义TypeScript接口
- 所有组件props必须定义类型
- 所有类型必须放在 `types/` 目录下
- 新增类型必须在 `types/index.ts` 中统一导出

## 7. 错误处理规范
- **重要**: 已实现统一的请求/响应拦截器，禁止在业务代码中重复处理通用错误
- 错误处理遵循以下流程:
  1. 网络错误由 `request.ts` 中的拦截器统一处理
  2. HTTP状态错误(401/404/500等)由拦截器统一处理
  3. 业务逻辑错误(code !== 0)由拦截器统一处理
- 特定业务错误可在API调用的 `catch` 块中处理

## 8. Layout使用规范

### 8.1 Layout组件架构
- **根目录Layout** (`/app/layout.tsx`): 全局包裹所有页面，包含菜单导航
- **子目录Layout** (如 `/app/study/layout.tsx`): 仅提供样式包装，不包含菜单导航

### 8.2 页面开发规则
- **禁止在页面组件中使用Layout组件**
- **所有页面都会被根目录Layout自动包裹**
- **页面直接返回内容，不要包裹Layout组件**

### 8.3 正确示例
✅ 正确的页面结构：
```tsx
// /app/study/word_bank/proverbs/page.tsx
const ProverbPage: React.FC = () => {
  return (
    <div className={styles.container}>
      <div className={styles.card}>
        {/* 页面内容 */}
      </div>
    </div>
  );
};
```

❌ 错误的页面结构：
```tsx
// 错误！不要在页面中使用Layout组件
const ProverbPage: React.FC = () => {
  return (
    <Layout>  {/* 错误！会导致菜单导航重复 */}
      <div className={styles.container}>
        {/* 页面内容 */}
      </div>
    </Layout>
  );
};
```

### 8.4 常见问题
- **问题**: 页面出现两个菜单导航
- **原因**: 页面中使用了Layout组件，导致嵌套
- **解决**: 移除页面中的Layout组件

## 9. 样式规范
- 页面样式必须使用 CSS Modules
- 样式文件命名必须与页面组件同名
- 页面容器类名必须使用 `.container`
- 卡片容器类名必须使用 `.card`
- 处理表格长文本的方式：固定宽度 + 文本截断 + 悬浮提示

## 9.1 /study 及子目录页面样式统一规范

- /study 及其子目录页面的 .container 样式必须如下：
  ```css
  .container {
    padding: 24px;
    background: #fff;
    min-height: 100vh;
  }
  ```
- 如需表格与筛选区域间距，统一新增 .tableWrapper：
  ```css
  .tableWrapper {
    margin-top: 24px;
  }
  ```
- 禁止出现 .card、.tableCard 等多余包裹和阴影，内容直接在 .container 内。

---

**目的**：保证所有 /study 相关页面视觉风格、留白、背景色完全一致，便于维护和扩展。
**新页面开发时，必须复用上述结构和样式，不得自定义卡片包裹。**

## 10. 路由规范
- 使用 Next.js App Router
- 路由结构跟随目录结构
- 动态路由使用 `[param]` 目录命名方式

## 11. 认证规范
- 使用JWT认证，Token存储在localStorage
- 认证状态管理统一使用 `utils/auth.ts` 中的方法
- 401错误统一处理为重定向到登录页

## 12. 主色调与主题色规范

### 12.1 主色调定义
- **主色调**：全站统一采用国风金棕色系，具体色值如下：
  - 主色：#bfa76a
  - 深色：#4b3a1e
  - 背景色：#f8f5ec
- 所有高亮、选中、主操作、按钮、Tag、卡片等视觉元素必须使用主色，严禁出现AntD默认蓝色。

### 12.2 全局CSS变量
- 在 `globals.css` 中定义如下变量，所有页面和组件均可直接复用：
  ```css
  :root {
    --color-primary: #bfa76a;
    --color-primary-dark: #4b3a1e;
    --color-primary-bg: #f8f5ec;
    --color-primary-hover: #bfa76a;
  }
  ```
- 所有自定义样式、背景、边框、hover、active等状态均应引用上述变量。

### 12.3 AntD主题配置（推荐方案）
- **强制规定**：通过AntD 5的 `ConfigProvider` 统一配置主题色，确保所有AntD组件自动应用主色：
  ```jsx
  <ConfigProvider
    theme={{
      token: {
        colorPrimary: '#bfa76a',
        // 其他token配置...
      },
      components: {
        Tag: {
          colorPrimary: '#bfa76a',
          // 其他Tag相关配置...
        },
        Button: {
          colorPrimary: '#bfa76a',
          // 其他Button相关配置...
        },
      },
    }}
  >
    {/* 应用内容 */}
  </ConfigProvider>
  ```
- **禁止**：在页面或组件中局部覆盖主色，禁止自定义主色class
- **要求**：所有AntD按钮、Tag、主操作等自动继承全局主色

### 12.4 组件与页面开发规范
- **强制规定**：新页面、新组件必须100%复用全局ConfigProvider和全局CSS变量配置
- **禁止**：出现 `color="blue"`、`.primaryTag` 等本地class或局部主色覆盖
- **推荐**：如需自定义主色按钮/Tag，优先用AntD的 `type="primary"` 或 `Tag` 组件
- **要求**：批次卡片、Tag、按钮等hover/选中/高亮状态均用主色

### 12.5 样式优先级与兼容性
- **重要**：遇到AntD 5+ CSS-in-JS样式优先级高于全局样式时，务必通过ConfigProvider的 `components.Tag` 等配置解决
- **处理方式**：如遇样式未生效，强制刷新缓存或删除本地样式class，确保全局唯一

### 12.6 传统CSS覆盖方案（备选）
- 在 `globals.css` 中全局覆盖 AntD 按钮和 Tag 的主色（仅作为备选方案）：
  ```css
  :global(.ant-btn-primary) {
    background: var(--color-primary) !important;
    border-color: var(--color-primary) !important;
    color: #fff !important;
  }
  :global(.ant-btn-primary:hover), :global(.ant-btn-primary:focus) {
    background: var(--color-primary-dark) !important;
    border-color: var(--color-primary-dark) !important;
    color: #fff !important;
  }
  :global(.ant-tag) {
    color: var(--color-primary-dark) !important;
    border-color: var(--color-primary) !important;
    background: var(--color-primary-bg) !important;
    font-weight: bold;
    border-radius: 4px;
  }
  ```

### 12.7 本地样式复用（备选）
- 如需自定义主色按钮/Tag，可直接使用 `.primaryButton`、`.primaryTag` 等 class：
  ```css
  .primaryButton {
    background: var(--color-primary);
    color: #fff;
    border: none;
    border-radius: 6px;
    font-weight: bold;
    box-shadow: none;
    transition: background 0.2s, color 0.2s;
  }
  .primaryButton:hover, .primaryButton:focus {
    background: var(--color-primary-dark);
    color: #fff;
  }
  .primaryTag {
    color: var(--color-primary-dark);
    border-color: var(--color-primary);
    background: var(--color-primary-bg);
    font-weight: bold;
    border-radius: 4px;
  }
  ```

### 12.8 规范执行要求
- **强制规定**：所有页面和组件必须遵循主色调规范，禁止使用AntD默认蓝色或其它色值作为主色
- **优先级**：优先使用AntD 5 ConfigProvider配置方案，备选CSS覆盖方案
- **一致性**：确保全站所有主色相关视觉元素风格高度统一

## 13. AntD组件样式覆盖规范

- **禁止**：在CSS Modules文件中直接写`:global(.xxx)`选择器（如`:global(.ant-btn-primary)`），否则会导致Next.js报pure selector错误。
- **推荐**：如需覆盖AntD组件样式，优先使用AntD的`ConfigProvider`组件进行局部主题定制，或在`globals.css`中写全局样式。
- **说明**：如需只影响某个弹窗/局部，建议用`ConfigProvider`包裹该组件并设置`theme.token`，避免全局污染和pure selector报错。
- **示例**：
  ```tsx
  <ConfigProvider
    theme={{
      token: {
        colorPrimary: '#000',
        colorPrimaryHover: '#333',
        colorPrimaryActive: '#333',
      },
    }}
  >
    <Modal>...</Modal>
  </ConfigProvider>
  ```